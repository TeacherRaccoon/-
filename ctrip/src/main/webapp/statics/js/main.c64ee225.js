var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&("function"==typeof Symbol?Symbol.toStringTag:"@@toStringTag")&&Object.defineProperty(e,"function"==typeof Symbol?Symbol.toStringTag:"@@toStringTag",{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([,,,function(e,t,n){n(4),e.exports=n(5)},function(e,t){"function"!=typeof Object.assign&&(Object.assign=function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);window.smart={register:r.register,request:r.request,response:r.response,log:r.log}},function(e,t,n){"use strict";var r,o,i,a,s,c,u,l;n.r(t),function(e){e.info="info",e.warning="warning",e.error="error"}(r||(r={})),(i=o||(o={})).PROD="PROD",i.FAT="FAT",i.UAT="UAT",i.DEV="DEV",i.unknown="unknown",(s=a||(a={})).H5="H5",s.Online="Online",s.Hybrid="Hybrid",s.RN="RN",s.Node="Node",(u=c||(c={})).ctrip="ctrip",u.trip="trip",function(e){e["2G"]="2G",e["3G"]="3G",e["4G"]="4G",e.offline="offline",e.unknown="unknown"}(l||(l={}));var f={},d=function(e,t){var n=null;if(t){var r=JSON.parse(localStorage.getItem(t)||"{}")[e];r&&r.reg>=Date.now()&&(n=r.val)}else n=localStorage.getItem(e);return n},p=function(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1440,r=arguments[3],o=JSON.parse(localStorage.getItem(r)||"{}"),i=new Date;i.setMinutes(i.getMinutes()+n),o[e]={reg:i.getTime(),val:t},localStorage.setItem(r,JSON.stringify(o))},g=function(e,t){var n=JSON.parse(localStorage.getItem(t)||"{}");delete n[e],localStorage.setItem(t,JSON.stringify(n))},m=function(e){return sessionStorage.getItem(e)},y=function(e,t){t="string"==typeof t?t:JSON.stringify(t),sessionStorage.setItem(e,t)},h=function(e){sessionStorage.removeItem(e)},v=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?decodeURIComponent(t[2]):null},w={module:"ottd",get:function(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},r=arguments[3];var o=n.cookies?n.cookies[e]:d(e,this.module)||m(e);return null==o&&null==n.cookies&&(o=v(e)),null!=o&&t&&"string"==typeof o&&(o=JSON.parse(o)),r&&r(o),o},set:function(e,t,n){0===n?y(e,t):this.module?p(e,t,n,this.module):console.log("请先注册")},clear:function(e,t){0===t?h(e):g(e,this.module)},register:function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"ottd";this.module=e}},b=o.unknown,k=function(){var e=a.RN;if("undefined"!=typeof document){var t=location.href;e=0===t.indexOf("http")?t.indexOf("//m.")>-1||t.indexOf("/m/")>-1||t.indexOf("wap.")>-1?a.H5:a.Online:a.Hybrid}else"undefined"!=typeof document&&"undefined"!=typeof window&&(e=a.Node);return e},O=l.unknown,S=null,U=null,x=function(e,t){t&&(U=null);var n,r=k();if(k()!==a.Node&&null!=U)return U;var o=_(e);return n=o.platform===a.RN?null():function(e){return{vid:function(e){var t=w.get("_bfa",!1,e);if(null==t)return null!=(t=w.get("CTRIP_UBT_M",!0,e))?t.vid:"";var n=t.split(".");return n.length>2?n[1]+"."+n[2]:""}(e),union:function(e){var t=w.get("Union",!1,e),n={sid:"",aid:"",ouid:""};if(!t)return n;var r={},o=t.split("&"),i=Array.isArray(o),a=0;for(o=i?o:o["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(i){if(a>=o.length)break;s=o[a++]}else{if((a=o.next()).done)break;s=a.value}var c=s.split("=");r[c[0]]=c[1]}for(var u in r){var l=["allianceid","aid","sid","ouid"],f=Array.isArray(l),d=0;for(l=f?l:l["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var p;if(f){if(d>=l.length)break;p=l[d++]}else{if((d=l.next()).done)break;p=d.value}var g=p;u.toLowerCase()==g&&(n[g]=r[u])}}return n.allianceid&&(n.aid=n.allianceid,delete n.allianceid),n}(e),url:e?e.protocol+"://"+e.headers.host+e.originalUrl:_().platform==a.Hybrid?location.hash:location.href,referrer:e?e.headers.referer:document.referrer,language:function(e){var t=(w.get("ibu_h5_local",!1,e)||"").split("-"),n=(w.get("ibulocale",!1,e)||"").split("-");return((_().platform===a.H5?t[1]&&t[0]+"-"+t[1].toUpperCase():n[1]&&n[0]+"-"+n[1].toUpperCase())||(_().channel===c.ctrip?"zh-CN":"en-US")).replace("_","-")}(),currency:function(e){return((_().platform===a.H5?w.get("ibu_h5_curr",!1,e):w.get("cookiePricesDisplayed",!1,e))||(_().channel===c.ctrip?"CNY":"USD")).toUpperCase()}(),userAgent:e?e.headers["user-agent"]:navigator.userAgent,cookie:e?e.headers.cookie:document.cookie,width:e?0:window.screen.width}}(e),_extends(n,o,{log_version:"2019-6-14-00"}),r!==a.Node&&(S=o,U=n),n},_=function(e){var t=k(),n=S;return t!==a.Node&&null!=n||(n={platform:t,enviroment:function(e,t){var n=o.DEV;switch(e){case a.H5:case a.Online:case a.Node:var r=a.Node===e?t.protocol+"://"+t.headers.host+t.originalUrl:location.origin;-1!==r.indexOf("trip")&&(n=-1!==r.indexOf("dev")?o.DEV:-1!==r.indexOf("fat")||-1!==r.indexOf("fws")?o.FAT:-1!==r.indexOf("uat")?o.UAT:o.PROD);break;case a.Hybrid:var i=w.get("CINFO",!0);if(i&&i.env)switch(i.env.toUpperCase()){case"PROD":return o.PROD;case"UAT":return o.UAT;case"FAT":return o.FAT;case"DEV":return o.DEV;default:return o.PROD}return o.PROD;case a.RN:n=f.enviroment}return n}(t,e),channel:function(e,t){var n=c.ctrip;switch(e){case a.H5:case a.Online:case a.Node:-1===(a.Node===e?t.protocol+"://"+t.headers.host+t.originalUrl:location.origin).indexOf(".ctrip")&&(n=c.trip);break;case a.Hybrid:n=c.ctrip;break;case a.RN:n=f.channel}return n}(t,e)}),n.platform===a.Hybrid&&n.enviroment===o.unknown&&(n.enviroment=b),t!==a.Node&&(S=n),n},N=function(){var e=_();switch(e.enviroment){case o.DEV:case o.FAT:return e.platform===a.Node?"http://gateway.m.fws.qa.nt.ctripcorp.com/restapi/soa2/":e.platform===a.RN?"http://gateway.m.fws.qa.nt.ctripcorp.com/restapi/soa2/":e.platform===a.Hybrid?"https://m.fat.ctripqa.com/restapi/soa2/":window.location.protocol+"//gateway.m.fws.qa.nt.ctripcorp.com/restapi/soa2/";case o.UAT:return e.platform===a.Node?"https://gateway.m.uat.qa.nt.ctripcorp.com/restapi/soa2/":"https://m.uat.ctripqa.com/restapi/soa2/";default:return e.platform===a.Node?"https://apigateway.ctripcorp.com/restapi/soa2/":"https://m.ctrip.com/restapi/soa2/"}},T={},C=0,R=Date.now(),I=function(e){return setTimeout(function(){V({title:"首屏时间",time:e,type:r.info,tags:{demeter:"firstScreen"}})},1e4)},D=function(){},P=function(){},j=function(e){},E=function(){function e(){_classCallCheck(this,e),this.dic={}}return _createClass(e,[{key:"next",value:function(e,t,n,r){var o=this,i=!1;null!=t?(t.loading&&(i=!0),this.nextPair(e,t,r,n)):(n.loading&&(i=!0),n.count=0,n.resonse=[],n.list.map(function(t,i){o.nextPair(e,_extends({pageId:n.pageId,count:i},t),r,n)})),i&&D()}},{key:"nextPair",value:function(e,t,n,r){var o=t.actionUrl;o=o.indexOf("http://")>-1?o:N()+o,_extends(t,{actionUrl:o}),this.dic[t.actionUrl]&&(clearTimeout(this.dic[t.actionUrl][1]),this.dic[t.actionUrl][0].abort());var i=this.send(e,t,n,r);if(!0!==n){var a=L(t);this.dic[t.actionUrl]=[i,this.setOverTime(t),a]}}},{key:"setOverTime",value:function(e){var t=this;return setTimeout(function(){t.dic[e.actionUrl][0].abort()},2e4)}},{key:"onFinish",value:function(e,t){(t?t.loading:e.loading)&&P(),this.dic[e.actionUrl]&&(clearTimeout(this.dic[e.actionUrl][1]),delete this.dic[e.actionUrl])}},{key:"onSuccess",value:function(e,t,n,o){try{null==n?t.success&&t.success(e):(n.count++,n.resonse[t.count]=e,n.count===n.list.length&&n.success&&n.success(n.resonse)),!0!==o&&J({token:this.dic[t.actionUrl][2],response:e,type:r.info}),this.onFinish(t,n)}catch(e){j("网络繁忙")}}},{key:"onFail",value:function(e,t,n,o,i){null==o?n.fail&&n.fail(e,t):(o.count++,o.resonse[n.count]=[e,t],o.count===o.list.length&&o.success&&o.success(o.resonse)),!0!==i&&J({token:this.dic[n.actionUrl][2],response:t,type:r.error,errorCode:e}),this.onFinish(n,o)}},{key:"send",value:function(e,t,n,r){var o,i=this,a=new XMLHttpRequest;return a.open(t.method||"POST",t.actionUrl,!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.setRequestHeader("Accept","application/json"),a.withCredentials=!0,o=-1!==t.actionUrl.indexOf("16879")||-1!==t.actionUrl.indexOf("17073")?{body:t.request}:t.request,"GET"===t.method?a.send():a.send(JSON.stringify(_extends({head:e},o))),a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status)try{var o=JSON.parse(a.responseText);o.ResponseStatus&&"Error"===o.ResponseStatus.Ack?i.onFail(o.ResponseStatus.Errors[0].ErrorCode,o,t,r,n):i.onSuccess(o,t,r,n)}catch(e){}else i.onFail(a.status.toString(),null,t,r,n)},a}}],[{key:"next",value:function(t,n,r,o){return this.instance||(this.instance=new e),this.instance.next(t,n,r,o)}}]),e}(),A=function(e,t,n){var r=x();r.pageId=e&&e.pageId||t&&t.pageId||G.pageId,r.netState=S.platform===a.RN?null():function(){if("undefined"!=typeof document&&window.clientInformation&&window.clientInformation.connection){var e=window.clientInformation.connection;switch(e.effectiveType){case"4g":return 0===e.rtt?l.offline:l["4G"];case"3g":return l["3G"];case"2g":return l["2G"];default:return l.unknown}}else{var t=window.CtripUtil&&window.CtripUtil.app_check_network_status;t&&t(function(e){!function(e){switch(e){case"2G":O=l["2G"];break;case"3G":O=l["3G"];break;case"WIFI":case"4G":O=l["4G"];break;case"None":O=l.offline;break;default:O=l.unknown}}(e.networkType)})}return O}(),E.next(r,e,t,n)},q=function(e){arguments.length>1&&arguments[1]!==undefined&&arguments[1];e&&(window.__bfi=window.__bfi||[]).push(["_tracklog",e.key,JSON.stringify(e)])},H=function(e){V({title:"白屏时间",time:Math.ceil(e),type:r.info,tags:{demeter:"domReady"}})};if("undefined"!=typeof document){var F=document.addEventListener?{type:"addEventListener",ready:"DOMContentLoaded"}:{type:"attachEvent",ready:"onreadystatechange"};"undefined"!=typeof performance?"complete"===document.readyState||"interactive"===document.readyState?setTimeout(function(){H(performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart)}):document[F.type](F.ready,function(){H(performance.now())},!1):V({title:"performance不支持",content:"无法拿到白屏数据",type:r.warning}),window[F.type]("error",function(e){e&&e.message&&V({title:"客户端脚本报错",type:r.error,tags:{message:e&&e.message||"",demeter:"jsError"}})},!0),window[F.type]("unhandledrejection",function(e){V({title:"客户端脚本报错",type:r.error,tags:{message:(e||window.event)&&(e||window.event).reason||"",demeter:"jsError"}})})}n.d(t,"init",function(){return G}),n.d(t,"register",function(){return M}),n.d(t,"request",function(){return L}),n.d(t,"response",function(){return J}),n.d(t,"log",function(){return V}),n.d(t,"ubtLog",function(){return B});var G={},M=function(e){e.sendURL=e.sendURL||"16879/sendlog",_extends(G,e)},L=function(e){return function(e){if(_().platform===a.Node)return"";e.startTime=Date.now();var t=Math.ceil(1e5*Math.random()).toString();return T[t]=e,t}(e)},J=function(e){!function(e){if(_().platform!==a.Node){var t=T[e.token];if(delete T[e.token],void 0===t)return V({title:"network_log接入方式错误",content:"空指针",type:r.error});var n,o=e.req;delete e.req,null==o&&!0===t.isFirstScreen&&(n=_(),clearTimeout(C),n.platform!==a.RN?"undefined"!=typeof performance?C=I(Math.ceil(performance.now())):V({title:"performance不支持",content:"无法拿到首屏数据",type:r.warning}):C=I(Math.ceil(Date.now()-R))),function(e,t){V({title:"网络请求",actionUrl:e.actionUrl,pageId:e.pageId,errorCode:t.errorCode,message:t.message,request:JSON.stringify(e.request||{}),response:JSON.stringify(t.response||{}),type:null!=t.errorCode?r.error:r.info,time:Math.ceil(Date.now()-e.startTime),tags:{demeter:"networkLog"}})}(t,e)}}(e)},V=function(e,t){!function(e,t){if(G.sendURL){var n=e||t;n.type=n.type||r.info,A({request:n,actionUrl:G.sendURL,success:function(n){!function(e,t,n){var r=e||t;if(r.tags&&r.tags.demeter){var o={key:r.tags.demeter};switch(r.tags.demeter){case"jsError":_extends(o,{message:r.tags.message});break;case"orderBlock":_extends(o,{message:r.content||r.tags.message,errorCode:r.tags.errorCode});break;case"domReady":case"firstScreen":_extends(o,{message:r.time,time:r.time});break;case"networkLog":null!=r.errorCode?_extends(o,{message:r.message,errorCode:r.errorCode,networkLogType:"error"}):_extends(o,{message:"success",networkLogType:"info"})}if(o.message){var i={};_extends(i,o,n||{},x()),q(i)}}}(e,t,n.Response)}},null,!0)}}(e,t)},B=function(e,t){q(e,t)}}]);
//# sourceMappingURL=main.js.a1ec24bf.map